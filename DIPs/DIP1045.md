# Disallow Unsafe Declarations

| Field           | Value                                                           |
|-----------------|-----------------------------------------------------------------|
| DIP:            |                                                                 |
| Review Count:   |                                                                 |
| Author:         | skyline131313                                                   |
| Implementation: |                                                                 |
| Status:         | Draft                                                           |

## Abstract

Disallow extern C and C++ function declarations from being marked `@safe` or `@trusted`.

## Contents
* [Rationale](#rationale)
* [Prior Work](#prior-work)
* [Description](#description)
* [Breaking Changes and Deprecations](#breaking-changes-and-deprecations)
* [Reference](#reference)
* [Copyright & License](#copyright--license)
* [Reviews](#reviews)

## Rationale

Foreign code that is interfaced cannot be guaranteed to be safe. It should always be assumed as unsafe. Especially C declarations as the types used are not mangled into the name of the function. It would be possible to link to a C function with the incorrect parameter types.

## Prior Work

Rust declares all foreign interfaces as unsafe, they cannot be explicitly marked as safe as there is only an `unsafe` keyword. [Rust avoids the issue of marking `unsafe` foreign declarations as `safe` entirely by design](https://doc.rust-lang.org/nomicon/ffi.html).

## Description

Any C or C++ function declaration with the `@safe` or `@trusted` attributes will now become an error.

```D
@safe    extern(C)   foo(); // Error: extern(C) declaration cannot be marked as `@safe`.
@trusted extern(C++) bar(); // Error: extern(C++) declaration cannot be marked as `@trusted`.
```

## Breaking Changes and Deprecations

Any extern C and C++ declarations that are marked with `@trusted` or `@safe` will cause breaking changes.

## Reference


## Copyright & License

Copyright (c) 2022 by the D Language Foundation

Licensed under [Creative Commons Zero 1.0](https://creativecommons.org/publicdomain/zero/1.0/legalcode.txt)

## Reviews

